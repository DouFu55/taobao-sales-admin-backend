import{a as k}from"./api-C4nkQ9Bl.js";import{d as J,p as L,o as W,c as Q,f as r,t as y,a,w as o,q as X,F as ee,r as b,m as te,b as i,e as ae,h as c,l as se,s as M,n as ne,M as d,_ as oe}from"./index-DQNgwPnH.js";const le={class:"main-container"},re={class:"header-section"},ie={class:"page-title"},de={class:"record-count"},ue={class:"action-bar"},pe={class:"filter-group"},ce={class:"action-buttons"},me={class:"data-card"},_e={class:"price-info"},ve={class:"price-text"},fe={class:"date-text"},ge={class:"date-text-secondary"},xe={class:"table-actions"},ye=J({__name:"OtherExpenseView",setup(be){const T=b([]),m=b([]),p=b(!1),g=b(!1),D=b(),h=M({current:1,pageSize:20,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50],size:"small"}),E=te(()=>{let t=[...T.value];if(m.value&&m.value.length===2&&m.value[0]){const l=new Date(m.value[0]).getTime(),u=new Date(m.value[1]).getTime();t=t.filter(v=>{const V=new Date(v.expense_date).getTime();return V>=l&&V<=u})}const e=t.sort((l,u)=>new Date(u.expense_date).getTime()-new Date(l.expense_date).getTime());return h.total=e.length,e}),O=t=>{h.current=t.current,h.pageSize=t.pageSize},$=t=>{w(),Object.assign(n,{...t,id:void 0}),n.expense_date=t.expense_date?.split("T")[0]||"",g.value=!1,p.value=!0},q=[{title:"ID",colKey:"id",width:80,align:"center"},{title:"支出日期",colKey:"expense_date",width:140},{title:"支出类型",colKey:"expense_type",width:120,align:"center"},{title:"项目名称",colKey:"item_name",width:180,ellipsis:!0},{title:"金额(元)",colKey:"amount",width:120,align:"right"},{title:"子订单号",colKey:"sub_order_no",width:150},{title:"备注",colKey:"remark",width:180,ellipsis:!0},{title:"创建时间",colKey:"created_at",width:190},{title:"操作",colKey:"operation",width:140,align:"center",fixed:"right"}],K={1:"办公用品",2:"水电费",3:"工资",4:"交通费",5:"差旅费",6:"设备购置",7:"其他"},S=t=>K[t]||`类型${t}`,U=t=>({1:"status-default",2:"status-info",3:"status-warning",4:"status-primary",5:"status-secondary",6:"status-success",7:"status-tertiary"})[t]||"status-default",F=t=>{if(!t||t.startsWith("0001"))return"-";const e=new Date(t),l=u=>u.toString().padStart(2,"0");return`${e.getFullYear()}-${l(e.getMonth()+1)}-${l(e.getDate())} ${l(e.getHours())}:${l(e.getMinutes())}:${l(e.getSeconds())}`},n=M({id:void 0,expense_date:"",expense_type:void 0,item_name:"",amount:void 0,sub_order_no:"",remark:""}),R={expense_date:[{required:!0,message:"必填",type:"error"}],expense_type:[{required:!0,message:"必填",type:"error"}],item_name:[{required:!0,message:"必填",type:"error"}],amount:[{required:!0,message:"必填",type:"error"}]},w=()=>{Object.assign(n,{id:void 0,expense_date:"",expense_type:void 0,item_name:"",amount:void 0,sub_order_no:"",remark:""}),ne(()=>{D.value?.clearValidate()})},Y=async()=>{if(await D.value?.validate()===!0){const e=d.loading("正在保存...");try{g.value?(await k.EditOtherExpenseItem({...n,id:n.id,expense_date:n.expense_date+"T00:00:00Z"})).code===200?(d.success("操作成功"),x(),p.value=!1):d.error("操作失败，请稍后重试"):(await k.CreateOtherExpenseItem({...n,expense_date:n.expense_date+"T00:00:00Z"})).code===200?(d.success("操作成功"),x(),p.value=!1):d.error("操作失败，请稍后重试")}catch{d.close(e),d.error("操作失败，请稍后重试")}finally{d.close(e)}}},x=async()=>{const t=await k.GetOtherExpenseList();t.code===200&&(T.value=t.data)},I=()=>{g.value=!1,w(),p.value=!0},j=t=>{w(),Object.assign(n,t),n.expense_date=t.expense_date?.split("T")[0]||"",g.value=!0,p.value=!0},B=async t=>{try{var e=!0;if(e){const l=d.loading("正在删除...");try{(await k.DeleteOtherExpenseItem(t.id)).code===200?(d.success("删除成功"),x()):d.error("删除失败，请稍后重试")}catch{d.error("删除失败，请稍后重试")}finally{d.close(l)}}}catch{}};return L(p,t=>{t||w()}),W(()=>{x()}),(t,e)=>{const l=i("t-date-range-picker"),u=i("t-icon"),v=i("t-button"),V=i("t-tag"),N=i("t-table"),P=i("t-date-picker"),f=i("t-form-item"),_=i("t-option"),Z=i("t-select"),C=i("t-input"),A=i("t-textarea"),G=i("t-form"),H=i("t-drawer");return ae(),Q(ee,null,[r("div",le,[r("div",re,[r("div",ie,[e[8]||(e[8]=r("h1",null,"其他支出管理",-1)),r("span",de,"共 "+y(E.value.length)+" 条记录",1)]),r("div",ue,[r("div",pe,[a(l,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"按支出日期筛选",clearable:"",onChange:x,style:{width:"300px"}},null,8,["modelValue"])]),r("div",ce,[a(v,{class:"action-btn",theme:"primary",onClick:I},{icon:o(()=>[a(u,{name:"add"})]),default:o(()=>[e[9]||(e[9]=c(" 添加支出数据 ",-1))]),_:1})])])]),r("div",me,[a(N,{data:E.value,columns:q,"row-key":"id",hover:!0,class:"custom-table",pagination:h,onPageChange:O,size:"medium"},{expense_type:o(({row:s})=>[a(V,{class:se(["type-tag",U(s.expense_type)]),variant:"light-outline"},{default:o(()=>[c(y(S(s.expense_type)),1)]),_:2},1032,["class"])]),amount:o(({row:s})=>[r("div",_e,[r("span",ve,"¥"+y(s.amount.toFixed(2)),1)])]),expense_date:o(({row:s})=>[r("span",fe,y(s.expense_date.split("T")[0]),1)]),created_at:o(({row:s})=>[r("span",ge,y(F(s.created_at)),1)]),operation:o(({row:s})=>[r("div",xe,[a(v,{variant:"text",theme:"primary",onClick:z=>j(s)},{default:o(()=>[...e[10]||(e[10]=[c("修改",-1)])]),_:1},8,["onClick"]),a(v,{variant:"text",theme:"danger",onClick:z=>$(s)},{default:o(()=>[...e[11]||(e[11]=[c("复制",-1)])]),_:1},8,["onClick"]),a(v,{variant:"text",theme:"danger",onClick:z=>B(s)},{default:o(()=>[...e[12]||(e[12]=[c("删除",-1)])]),_:1},8,["onClick"])])]),_:1},8,["data","pagination"])])]),a(H,{visible:p.value,"onUpdate:visible":e[7]||(e[7]=s=>p.value=s),size:"500px",placement:"right",onConfirm:Y,"close-on-overlay-click":!1},X({default:o(()=>[a(G,{ref_key:"formRef",ref:D,rules:R,data:n,"label-align":"right","label-width":120},{default:o(()=>[a(f,{label:"支出日期",name:"expense_date",required:""},{default:o(()=>[a(P,{modelValue:n.expense_date,"onUpdate:modelValue":e[1]||(e[1]=s=>n.expense_date=s),format:"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(f,{label:"支出类型",name:"expense_type",required:""},{default:o(()=>[a(Z,{modelValue:n.expense_type,"onUpdate:modelValue":e[2]||(e[2]=s=>n.expense_type=s),clearable:""},{default:o(()=>[a(_,{value:1,label:"办公用品"}),a(_,{value:2,label:"水电费"}),a(_,{value:3,label:"工资"}),a(_,{value:4,label:"交通费"}),a(_,{value:5,label:"差旅费"}),a(_,{value:6,label:"设备购置"}),a(_,{value:7,label:"其他"})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"项目名称",name:"item_name",required:""},{default:o(()=>[a(C,{modelValue:n.item_name,"onUpdate:modelValue":e[3]||(e[3]=s=>n.item_name=s),maxlength:200},null,8,["modelValue"])]),_:1}),a(f,{label:"金额(元)",name:"amount",required:""},{default:o(()=>[a(C,{modelValue:n.amount,"onUpdate:modelValue":e[4]||(e[4]=s=>n.amount=s),type:"number",step:"0.01"},{prefix:o(()=>[...e[15]||(e[15]=[c("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"子订单号",name:"sub_order_no"},{default:o(()=>[a(C,{modelValue:n.sub_order_no,"onUpdate:modelValue":e[5]||(e[5]=s=>n.sub_order_no=s),maxlength:100},null,8,["modelValue"])]),_:1}),a(f,{label:"备注",name:"remark"},{default:o(()=>[a(A,{modelValue:n.remark,"onUpdate:modelValue":e[6]||(e[6]=s=>n.remark=s),maxlength:500,autosize:{minRows:3}},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:2},[g.value?{name:"header",fn:o(()=>[e[13]||(e[13]=c("编辑其他支出",-1))]),key:"0"}:{name:"header",fn:o(()=>[e[14]||(e[14]=c("添加其他支出",-1))]),key:"1"}]),1032,["visible"])],64)}}}),Ve=oe(ye,[["__scopeId","data-v-a3d0e97f"]]);export{Ve as default};
