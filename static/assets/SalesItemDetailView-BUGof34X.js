import{a as g}from"./api-C4nkQ9Bl.js";import{d as at,o as ot,c as y,f as e,t as o,a as i,w as n,F as lt,r as _,m as it,M as d,b as p,h as r,l as nt,i as w,e as C,_ as dt}from"./index-DQNgwPnH.js";const rt={class:"main-container"},ct={class:"header-section"},ut={class:"page-title"},_t={class:"record-count"},vt={class:"action-bar"},pt={class:"search-container"},mt={class:"filter-container"},ft={class:"action-buttons"},bt={class:"data-table"},ht={class:"product-info"},gt={class:"product-title"},yt={key:0,class:"product-attr"},Ct={key:1,class:"product-sku"},kt={class:"price-info"},xt={class:"actual-price"},wt={class:"original-price"},St={class:"table-actions"},Dt={class:"table-actions"},Vt={key:0,class:"detail-content"},zt={class:"detail-layout"},Tt={class:"detail-left"},$t={class:"detail-section"},At={class:"info-grid"},It={class:"info-item"},Kt={class:"value"},Bt={class:"info-item"},Ut={class:"value"},Ot={class:"info-item"},Et={class:"value"},Ft={class:"info-item"},Lt={class:"value"},Nt={class:"info-item"},Pt={class:"label"},jt={class:"info-item"},Mt={class:"label"},Rt={class:"detail-section"},qt={class:"info-item"},Gt={class:"value"},Jt={key:0,class:"info-item"},Zt={class:"value"},Ht={class:"info-item"},Qt={class:"label"},Wt={class:"detail-right"},Xt={class:"detail-section"},Yt={class:"info-grid"},te={class:"info-item"},ee={class:"label"},se={class:"info-item"},ae={class:"label"},oe={key:0,class:"info-item"},le={class:"label"},ie={class:"detail-section"},ne={class:"info-grid"},de={class:"info-item"},re={class:"info-item"},ce={class:"value"},ue={class:"detail-section"},_e={class:"info-grid"},ve={class:"info-item"},pe={class:"label"},me={class:"info-item"},fe={class:"label"},be=at({__name:"SalesItemDetailView",setup(he){const v=_([]),V=_(!1),b=_(""),S=_(!1),l=_(null),z=_("all"),h=_({current:1,pageSize:10,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50,100]}),B=[{title:"订单号",colKey:"sub_order_id",width:200},{title:"商品信息",colKey:"product",width:300},{title:"金额",colKey:"price",width:120,align:"right"},{title:"数量",colKey:"quantity",width:80,align:"center"},{title:"状态",colKey:"status",width:100,align:"center"},{title:"下单时间",colKey:"order_create_time",width:180,cell:(s,{row:t})=>$(t.order_create_time)},{title:"操作",colKey:"actions",width:180,align:"center",fixed:"right"}],T=it(()=>{let s=[...v.value];if(b.value.trim()){const t=b.value.toLowerCase();s=s.filter(c=>c.sub_order_id.toLowerCase().includes(t)||c.main_order_id.toLowerCase().includes(t))}return z.value==="paid"&&(s=s.filter(t=>t.buyer_paid>0)),s.sort((t,c)=>{const u=new Date(t.order_create_time).getTime();return new Date(c.order_create_time).getTime()-u}),s}),U=s=>{const t={买家已付款:"待发货",已发货:"已发货",交易成功:"已完成",交易关闭:"已关闭"};for(const[c,u]of Object.entries(t))if(s.includes(c))return u;return s},O=s=>{const t={买家已付款:"status-pending",已发货:"status-warning",交易成功:"status-success",交易关闭:"status-default"};for(const[c,u]of Object.entries(t))if(s.includes(c))return u;return"status-default"},E=s=>{const t={买家已付款:"primary",已发货:"warning",交易成功:"success",交易关闭:"default"};for(const[c,u]of Object.entries(t))if(s.includes(c))return u;return"primary"},$=s=>s?s.replace("T"," ").replace("Z","").split(".")[0].split("+")[0]:"-",F=s=>{l.value=s,S.value=!0},L=()=>{S.value=!1,setTimeout(()=>{l.value=null},300)},N=()=>{if(!b.value.trim()){d.warning("请输入订单号");return}},P=()=>{b.value=""},j=s=>{h.value.current=s.current,h.value.pageSize=s.pageSize,h.value.total=T.value.length},m=async()=>{try{V.value=!0;const s=await g.GetSalesItemDetailList();s&&s.data?s.data.code===200&&s.data.data?v.value=s.data.data:Array.isArray(s.data)?v.value=s.data:s.data.code===200&&Array.isArray(s.data.data)?v.value=s.data.data:v.value=[]:Array.isArray(s)?v.value=s:v.value=[],h.value.total=v.value.length}catch(s){console.error("获取数据失败:",s),d.error("获取数据失败"),h.value.total=v.value.length}finally{V.value=!1}},k=_(!1),I=_(""),D=_(0),M=()=>{k.value=!1},R=s=>{D.value=0,I.value=s.sub_order_id,k.value=!0},q=()=>{G(I.value,D.value),k.value=!1},G=async(s,t)=>{if(t<=0){d.warning("无可退款金额");return}try{await g.RefundAmount(s,t),d.success(`订单 ${s} 已退款 ¥${t}`),m()}catch{d.error("退款失败")}},J=()=>{d.success("导入成功"),m()},Z=()=>{d.error("导入失败")},H=async s=>{try{await g.ShipsImmediately(s.sub_order_id),d.success(`订单 ${s.sub_order_id} 已发货`),m()}catch{d.error("发货失败")}},Q=async s=>{try{await g.CloseTransaction(s.sub_order_id),d.success(`订单 ${s.sub_order_id} 已关闭`),m()}catch{d.error("关闭交易失败")}},W=async s=>{try{await g.CompleteTransaction(s.sub_order_id),d.success(`订单 ${s.sub_order_id} 已完成`),m()}catch{d.error("完成交易失败")}},X=async s=>{try{await g.DeleteSalesItem(s.sub_order_id),d.success(`订单 ${s.sub_order_id} 已删除`),m()}catch{d.error("删除订单失败")}};return ot(()=>{m()}),(s,t)=>{const c=p("t-icon"),u=p("t-input"),A=p("t-radio-button"),Y=p("t-radio-group"),tt=p("t-upload"),f=p("t-button"),et=p("t-table"),st=p("t-tag"),K=p("t-dialog");return C(),y(lt,null,[e("div",rt,[e("div",ct,[e("div",ut,[t[5]||(t[5]=e("h1",null,"销售明细",-1)),e("span",_t,o(T.value.length)+" 条记录",1)]),e("div",vt,[e("div",pt,[i(u,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),placeholder:"搜索订单号",clearable:"",class:"search-input",onEnter:N,onClear:P},{"prefix-icon":n(()=>[i(c,{name:"search"})]),_:1},8,["modelValue"])]),e("div",mt,[i(Y,{modelValue:z.value,"onUpdate:modelValue":t[1]||(t[1]=a=>z.value=a),variant:"default-filled",size:"medium"},{default:n(()=>[i(A,{value:"all"},{default:n(()=>[...t[6]||(t[6]=[r("全部订单",-1)])]),_:1}),i(A,{value:"paid"},{default:n(()=>[...t[7]||(t[7]=[r("实付大于0",-1)])]),_:1})]),_:1},8,["modelValue"])]),e("div",ft,[i(tt,{action:"http://127.0.0.1:30001/api/sales/execl/upload",theme:"custom",onSuccess:J,onFail:Z}),i(f,{theme:"primary",class:"action-btn"},{default:n(()=>[...t[8]||(t[8]=[r(" 新建 ",-1)])]),_:1})])])]),e("div",bt,[i(et,{"row-key":"id",data:T.value,columns:B,loading:V.value,bordered:!1,hover:!0,size:"medium",pagination:h.value,onPageChange:j},{product:n(({row:a})=>[e("div",ht,[e("div",gt,o(a.product_title),1),a.product_attr?(C(),y("div",yt,o(a.product_attr),1)):w("",!0),a.sku_code?(C(),y("div",Ct,o(a.sku_code),1)):w("",!0)])]),price:n(({row:a})=>[e("div",kt,[e("div",xt,"¥"+o(a.buyer_paid),1),e("div",wt,"¥"+o(a.product_price),1)])]),status:n(({row:a})=>[e("div",{class:nt(["status-badge",O(a.order_status)])},o(U(a.order_status)),3)]),actions:n(({row:a})=>[e("div",St,[i(f,{variant:"text",size:"small",onClick:x=>H(a)},{default:n(()=>[...t[9]||(t[9]=[r(" 发货 ",-1)])]),_:1},8,["onClick"]),t[13]||(t[13]=r("  ",-1)),i(f,{variant:"text",size:"small",onClick:x=>R(a)},{default:n(()=>[...t[10]||(t[10]=[r(" 退款 ",-1)])]),_:1},8,["onClick"]),t[14]||(t[14]=r("  ",-1)),i(f,{variant:"text",size:"small",onClick:x=>W(a)},{default:n(()=>[...t[11]||(t[11]=[r(" 完成 ",-1)])]),_:1},8,["onClick"]),t[15]||(t[15]=r("  ",-1)),i(f,{variant:"text",size:"small",onClick:x=>Q(a)},{default:n(()=>[...t[12]||(t[12]=[r(" 关闭 ",-1)])]),_:1},8,["onClick"])]),e("div",Dt,[i(f,{variant:"text",size:"small",onClick:x=>F(a)},{default:n(()=>[...t[16]||(t[16]=[r(" 详情 ",-1)])]),_:1},8,["onClick"]),t[18]||(t[18]=r("  ",-1)),i(f,{variant:"text",size:"small",onClick:x=>X(a)},{default:n(()=>[...t[17]||(t[17]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1},8,["data","loading","pagination"])]),i(K,{visible:S.value,"onUpdate:visible":t[2]||(t[2]=a=>S.value=a),header:"订单详情",footer:!1,width:"800px",onClose:L,class:"detail-dialog"},{default:n(()=>[l.value?(C(),y("div",Vt,[e("div",zt,[e("div",Tt,[e("div",$t,[t[23]||(t[23]=e("h3",{class:"section-title"},"订单信息",-1)),e("div",At,[e("div",It,[t[19]||(t[19]=e("span",{class:"label"},"子订单号",-1)),e("span",Kt,o(l.value.sub_order_id),1)]),e("div",Bt,[t[20]||(t[20]=e("span",{class:"label"},"主订单号",-1)),e("span",Ut,o(l.value.main_order_id),1)]),e("div",Ot,[t[21]||(t[21]=e("span",{class:"label"},"商品ID",-1)),e("span",Et,o(l.value.product_id),1)]),e("div",Ft,[t[22]||(t[22]=e("span",{class:"label"},"SKU编码",-1)),e("span",Lt,o(l.value.sku_code||"-"),1)]),e("div",Nt,[e("span",Pt,"套餐信息："+o(l.value.meal_info||"无"),1)]),e("div",jt,[e("span",Mt,"卖家备注："+o(l.value.seller_remark||"无"),1)])])]),e("div",Rt,[t[26]||(t[26]=e("h3",{class:"section-title"},"商品信息",-1)),e("div",qt,[t[24]||(t[24]=e("span",{class:"label"},"商品标题：",-1)),e("span",Gt,o(l.value.product_title),1)]),l.value.product_attr?(C(),y("div",Jt,[t[25]||(t[25]=e("span",{class:"label"},"商品规格：",-1)),e("span",Zt,o(l.value.product_attr),1)])):w("",!0),e("div",Ht,[e("span",Qt,"购买数量："+o(l.value.quantity),1)])])]),e("div",Wt,[e("div",Xt,[t[27]||(t[27]=e("h3",{class:"section-title"},"金额信息",-1)),e("div",Yt,[e("div",te,[e("span",ee,"商品标价：¥"+o(l.value.product_price),1)]),e("div",se,[e("span",ae,"实付金额：¥"+o(l.value.buyer_paid),1)]),l.value.refund_amount>0?(C(),y("div",oe,[e("span",le,"退款金额：¥"+o(l.value.refund_amount),1)])):w("",!0)])]),e("div",ie,[t[30]||(t[30]=e("h3",{class:"section-title"},"状态信息",-1)),e("div",ne,[e("div",de,[t[28]||(t[28]=e("span",{class:"label"},"订单状态",-1)),i(st,{theme:E(l.value.order_status),size:"small"},{default:n(()=>[r(o(l.value.order_status),1)]),_:1},8,["theme"])]),e("div",re,[t[29]||(t[29]=e("span",{class:"label"},"退款状态",-1)),e("span",ce,o(l.value.refund_status),1)])])]),e("div",ue,[t[31]||(t[31]=e("h3",{class:"section-title"},"时间信息",-1)),e("div",_e,[e("div",ve,[e("span",pe,"下单时间："+o($(l.value.order_create_time)),1)]),e("div",me,[e("span",fe,"支付时间："+o($(l.value.order_pay_time)),1)])])])])])])):w("",!0)]),_:1},8,["visible"])]),i(K,{visible:k.value,"onUpdate:visible":t[4]||(t[4]=a=>k.value=a),header:"退款",placement:"center",width:"400px",confirmBtn:"退款",onConfirm:q,onClose:M,class:"refund-dialog"},{default:n(()=>[i(u,{label:"退款金额：",suffix:"元",type:"number",modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=a=>D.value=a)},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}}),Ce=dt(be,[["__scopeId","data-v-702afbea"]]);export{Ce as default};
