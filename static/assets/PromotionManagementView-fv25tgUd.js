import{a as V}from"./api-C4nkQ9Bl.js";import{d as L,p as W,o as Q,c as X,f as s,t as y,a as o,w as n,q as Z,F as ee,r as b,m as te,b as r,e as oe,h as u,l as ae,s as q,n as ne,M as h,_ as le}from"./index-DQNgwPnH.js";const se={class:"main-container"},re={class:"header-section"},ie={class:"page-title"},de={class:"record-count"},ue={class:"action-bar"},me={class:"filter-group"},pe={class:"action-buttons"},ce={class:"data-card"},_e={class:"price-text"},ve={class:"date-text"},ge={class:"date-text-secondary"},fe={class:"table-actions"},ye=L({__name:"PromotionManagementView",setup(be){const C=b([]),m=b([]),d=b(!1),v=b(!1),k=b(),x=q({current:1,pageSize:20,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50],size:"small"}),M=t=>{x.current=t.current,x.pageSize=t.pageSize},P=t=>{w(),Object.assign(l,{...t,id:void 0}),l.promotion_date=t.promotion_date.split("T")[0]||"",v.value=!1,d.value=!0},T=te(()=>{let t=[...C.value];if(m.value&&m.value.length===2&&m.value[0]){const e=new Date(m.value[0]).getTime(),i=new Date(m.value[1]).getTime();t=t.filter(f=>{const p=new Date(f.promotion_date).getTime();return p>=e&&p<=i})}return x.total=t.length,t.sort((e,i)=>new Date(i.promotion_date).getTime()-new Date(e.promotion_date).getTime())}),S=[{title:"ID",colKey:"id",width:80,align:"center"},{title:"推广日期",colKey:"promotion_date",width:140},{title:"推广类型",colKey:"promotion_type",width:140,align:"center"},{title:"计划ID",colKey:"plan_id",width:140},{title:"消耗金额",colKey:"expense_amount",width:130,align:"right"},{title:"订单数",colKey:"orders_count",width:100,align:"center"},{title:"备注",colKey:"remark",ellipsis:!0},{title:"创建时间",colKey:"created_at",width:190},{title:"操作",colKey:"operation",width:140,align:"center",fixed:"right"}],z={1:"商品全站推广",2:"关键词推广",3:"人群推广",4:"内容推广",5:"淘宝联盟",6:"营销托管",7:"其他"},K=t=>z[t]||`类型${t}`,U=t=>({1:"status-info",2:"status-primary",3:"status-secondary",4:"status-success",5:"status-warning",6:"status-tertiary",7:"status-default"})[t]||"status-default",F=t=>{if(!t||t.startsWith("0001"))return"-";const e=new Date(t),i=f=>f.toString().padStart(2,"0");return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())} ${i(e.getHours())}:${i(e.getMinutes())}:${i(e.getSeconds())}`},l=q({id:void 0,promotion_date:"",promotion_type:void 0,plan_id:"",expense_amount:void 0,orders_count:void 0,remark:""}),I={promotion_date:[{required:!0,message:"必填",type:"error"}],promotion_type:[{required:!0,message:"必填",type:"error"}],plan_id:[{required:!0,message:"必填",type:"error"}],expense_amount:[{required:!0,message:"必填",type:"error"}],orders_count:[{required:!0,message:"必填",type:"error"}]},w=()=>{Object.assign(l,{id:void 0,promotion_date:"",promotion_type:void 0,plan_id:"",expense_amount:void 0,orders_count:void 0,remark:""}),ne(()=>{k.value?.clearValidate()})},Y=async()=>{await k.value.validate()===!0&&(v.value?V.EditPromotionItem(l).then(e=>{e.code===200?(h.success("修改成功"),d.value=!1,g()):h.error(e.message)}):V.CreatePromotionItem(l).then(e=>{e.code===200?(h.success("添加成功"),d.value=!1,g()):h.error(e.message)}))},g=async()=>{const t=await V.GetPromotionList();t.code===200&&(C.value=t.data)},R=()=>{v.value=!1,w(),d.value=!0},E=t=>{w();const e=new Date(t.promotion_date);Object.assign(l,{...t,promotion_date:`${e.getFullYear()}-${("0"+(e.getMonth()+1)).slice(-2)}-${("0"+e.getDate()).slice(-2)}`,promotion_type:Number(t.promotion_type)}),v.value=!0,d.value=!0},N=t=>{V.DeletePromotionItem(t.id).then(e=>{e.code===200&&(h.success("删除成功"),g())})};return W(d,t=>{t||w()}),Q(()=>g()),(t,e)=>{const i=r("t-date-range-picker"),f=r("t-icon"),p=r("t-button"),O=r("t-tag"),j=r("t-table"),B=r("t-date-picker"),_=r("t-form-item"),c=r("t-option"),A=r("t-select"),D=r("t-input"),G=r("t-textarea"),H=r("t-form"),J=r("t-drawer");return oe(),X(ee,null,[s("div",se,[s("div",re,[s("div",ie,[e[8]||(e[8]=s("h1",null,"推广支出管理",-1)),s("span",de,"共 "+y(T.value.length)+" 条记录",1)]),s("div",ue,[s("div",me,[o(i,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),placeholder:"按推广日期筛选",clearable:"",onChange:g,style:{width:"320px"}},null,8,["modelValue"])]),s("div",pe,[o(p,{class:"action-btn",theme:"primary",onClick:R},{icon:n(()=>[o(f,{name:"add"})]),default:n(()=>[e[9]||(e[9]=u(" 添加数据 ",-1))]),_:1})])])]),s("div",ce,[o(j,{data:T.value,columns:S,"row-key":"id",hover:!0,pagination:x,onPageChange:M,class:"custom-table"},{promotion_type:n(({row:a})=>[o(O,{class:ae(["type-tag",U(a.promotion_type)]),variant:"light-outline"},{default:n(()=>[u(y(K(a.promotion_type)),1)]),_:2},1032,["class"])]),expense_amount:n(({row:a})=>[s("span",_e,"¥"+y(a.expense_amount.toFixed(2)),1)]),promotion_date:n(({row:a})=>[s("span",ve,y(a.promotion_date.split("T")[0]),1)]),created_at:n(({row:a})=>[s("span",ge,y(F(a.created_at)),1)]),operation:n(({row:a})=>[s("div",fe,[o(p,{variant:"text",theme:"primary",onClick:$=>E(a)},{default:n(()=>[...e[10]||(e[10]=[u("修改",-1)])]),_:1},8,["onClick"]),o(p,{variant:"text",theme:"primary",onClick:$=>P(a)},{default:n(()=>[...e[11]||(e[11]=[u("复制",-1)])]),_:1},8,["onClick"]),o(p,{variant:"text",theme:"danger",onClick:$=>N(a)},{default:n(()=>[...e[12]||(e[12]=[u("删除",-1)])]),_:1},8,["onClick"])])]),_:1},8,["data","pagination"])])]),o(J,{visible:d.value,"onUpdate:visible":e[7]||(e[7]=a=>d.value=a),size:"500px",placement:"right",onConfirm:Y,"close-on-overlay-click":!0},Z({default:n(()=>[o(H,{ref_key:"formRef",ref:k,rules:I,data:l,"label-align":"right","label-width":120,"show-error-helper":""},{default:n(()=>[o(_,{label:"推广日期",name:"promotion_date",required:""},{default:n(()=>[o(B,{modelValue:l.promotion_date,"onUpdate:modelValue":e[1]||(e[1]=a=>l.promotion_date=a),format:"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(_,{label:"推广类型",name:"promotion_type",required:""},{default:n(()=>[o(A,{modelValue:l.promotion_type,"onUpdate:modelValue":e[2]||(e[2]=a=>l.promotion_type=a),clearable:""},{default:n(()=>[o(c,{value:1,label:"商品全站推广"}),o(c,{value:2,label:"关键词推广"}),o(c,{value:3,label:"人群推广"}),o(c,{value:4,label:"内容推广"}),o(c,{value:5,label:"淘宝联盟"}),o(c,{value:6,label:"营销托管"}),o(c,{value:7,label:"其他"})]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"计划ID",name:"plan_id",required:""},{default:n(()=>[o(D,{modelValue:l.plan_id,"onUpdate:modelValue":e[3]||(e[3]=a=>l.plan_id=a),maxlength:100},null,8,["modelValue"])]),_:1}),o(_,{label:"消耗金额",name:"expense_amount",required:""},{default:n(()=>[o(D,{modelValue:l.expense_amount,"onUpdate:modelValue":e[4]||(e[4]=a=>l.expense_amount=a),type:"number",step:"0.01"},{prefix:n(()=>[...e[15]||(e[15]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"订单数",name:"orders_count",required:""},{default:n(()=>[o(D,{modelValue:l.orders_count,"onUpdate:modelValue":e[5]||(e[5]=a=>l.orders_count=a),type:"number"},null,8,["modelValue"])]),_:1}),o(_,{label:"备注",name:"remark"},{default:n(()=>[o(G,{modelValue:l.remark,"onUpdate:modelValue":e[6]||(e[6]=a=>l.remark=a),maxlength:200,autosize:{minRows:3}},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:2},[v.value?{name:"header",fn:n(()=>[e[13]||(e[13]=u("编辑推广费用",-1))]),key:"0"}:{name:"header",fn:n(()=>[e[14]||(e[14]=u("添加推广费用",-1))]),key:"1"}]),1032,["visible"])],64)}}}),we=le(ye,[["__scopeId","data-v-3fa74ef8"]]);export{we as default};
