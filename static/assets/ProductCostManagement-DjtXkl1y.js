import{a as y}from"./api-C4nkQ9Bl.js";import{d as Y,p as Q,o as X,c as K,f as i,t as v,a as o,w as s,q as Z,F as ee,r as p,m as te,M as V,b as d,e as $,u as D,I as U,h as u,i as ae,n as le,D as oe,_ as se}from"./index-DQNgwPnH.js";const ne={class:"main-container"},ie={class:"header-section"},ue={class:"page-title"},re={class:"record-count"},de={class:"action-bar"},ce={class:"filter-group"},pe={class:"action-buttons"},me={class:"data-card"},_e={class:"product-info-cell"},ve={class:"product-title"},ge={class:"product-sku"},fe={key:0,class:"product-attr"},he={class:"price-detail"},be={class:"price-text"},Ve={class:"cost-label"},ke={class:"table-actions"},ye=Y({__name:"ProductCostManagement",setup(Ce){const q=p([]),C=p(!1),h=p(""),m=p([]),g=p(!1),f=p(!1),x=p(),b=p({current:1,pageSize:20,total:0,showJumper:!0,showPageSize:!0,size:"small"}),t=p({id:"",sku:"",product_id:"",product_name:"",spec_info:"",purchase_price:"",shipping_cost:"",handling_cost:"",other_cost:"",total_cost:"",supplier:"",stock:"",is_active:!0}),z=[{title:"ID",colKey:"id",width:80,align:"center"},{title:"商品信息",colKey:"productInfo",minWidth:280},{title:"商品ID",colKey:"product_id",width:140},{title:"成本明细",colKey:"priceInfo",width:150,align:"right"},{title:"供应商",colKey:"supplier",width:150,ellipsis:!0},{title:"库存",colKey:"stock",width:100,align:"center",cell:(a,{row:e})=>{const n=Number(e.stock),c=n<=0?"stock-empty":n<50?"stock-low":"";return a("span",{class:c},n.toLocaleString())}},{title:"状态",colKey:"statusCell",width:100,align:"center"},{title:"创建时间",colKey:"created_at",width:180,cell:(a,{row:e})=>M(e.created_at)},{title:"操作",colKey:"op",width:140,align:"center",fixed:"right"}],M=a=>{if(!a||a.startsWith("0001"))return"-";const e=new Date(a),n=c=>c.toString().padStart(2,"0");return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`},F=a=>{S(),Object.assign(t.value,{...a,id:""}),t.value.product_id=a.product_id.toString(),t.value.purchase_price=a.purchase_price.toString(),t.value.shipping_cost=a.shipping_cost.toString(),t.value.handling_cost=a.handling_cost.toString(),t.value.other_cost=a.other_cost.toString(),t.value.total_cost=a.total_cost.toString(),t.value.stock=a.stock.toString(),f.value=!1,g.value=!0},N=te(()=>{let a=[...q.value];if(h.value.trim()){const e=h.value.toLowerCase();a=a.filter(n=>n.sku?.toLowerCase().includes(e)||n.product_name?.toLowerCase().includes(e)||n.supplier?.toLowerCase().includes(e))}if(m.value&&m.value.length===2&&m.value[0]){const e=new Date(m.value[0]).getTime(),n=new Date(m.value[1]).getTime();a=a.filter(c=>{const _=new Date(c.created_at||"").getTime();return _>=e&&_<=n})}return a.sort((e,n)=>n.id-e.id)});Q(()=>[t.value.purchase_price,t.value.shipping_cost,t.value.handling_cost,t.value.other_cost],()=>{const a=Number(t.value.purchase_price)||0,e=Number(t.value.shipping_cost)||0,n=Number(t.value.handling_cost)||0,c=Number(t.value.other_cost)||0;t.value.total_cost=(a+e+n+c).toFixed(2)},{deep:!0});const S=()=>{t.value={id:"",sku:"",product_id:"",product_name:"",spec_info:"",purchase_price:"",shipping_cost:"",handling_cost:"",other_cost:"",total_cost:"",supplier:"",stock:"",is_active:!0},le(()=>{x.value?.clearValidate()})},k=async()=>{C.value=!0;try{const a=await y.GetCostList();a.code===200&&(q.value=a.data,b.value.total=a.data.length)}catch{V.error("获取数据失败")}finally{C.value=!1}},P=async()=>{if(await x.value.validate()===!0){const e={...t.value,id:f.value?Number(t.value.id):void 0,product_id:Number(t.value.product_id),purchase_price:Number(t.value.purchase_price),shipping_cost:Number(t.value.shipping_cost),handling_cost:Number(t.value.handling_cost),other_cost:Number(t.value.other_cost),total_cost:Number(t.value.total_cost),stock:Number(t.value.stock)};try{f.value?(await y.EditCostItem(e),V.success("数据更新成功")):(await y.CreateCostItem(e),V.success("数据添加成功")),g.value=!1,k()}catch{V.error("提交失败，请检查网络")}}},T=()=>{f.value=!1,S(),g.value=!0},L=a=>{S(),f.value=!0,t.value={...a,id:a.id.toString(),product_id:a.product_id.toString(),purchase_price:a.purchase_price.toString(),shipping_cost:a.shipping_cost.toString(),handling_cost:a.handling_cost.toString(),other_cost:a.other_cost.toString(),total_cost:a.total_cost.toString(),stock:a.stock.toString()},g.value=!0},B=a=>{const e=oe.confirm({header:"确认删除",body:`确定要永久删除商品 [${a.product_name}] 的成本记录吗？`,onConfirm:async()=>{await y.DeleteCostItem(a.id),V.success("删除成功"),k(),e.destroy()}})},E=a=>{b.value.current=a.current,b.value.pageSize=a.pageSize},R=()=>{b.value.current=1},G=()=>{k(),h.value="",m.value=[]},W={sku:[{required:!0,message:"请输入SKU",trigger:"blur"}],product_id:[{required:!0,message:"请输入商品ID",trigger:"blur"}],product_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],purchase_price:[{required:!0,message:"金额不能为空",trigger:"blur"}],supplier:[{required:!0,message:"请输入供应商",trigger:"blur"}],stock:[{required:!0,message:"请输入库存",trigger:"blur"}]};return X(()=>k()),(a,e)=>{const n=d("t-input"),c=d("t-date-range-picker"),_=d("t-button"),j=d("t-tag"),A=d("t-table"),r=d("t-form-item"),I=d("t-divider"),H=d("t-switch"),J=d("t-form"),O=d("t-drawer");return $(),K(ee,null,[i("div",ne,[i("div",ie,[i("div",ue,[e[15]||(e[15]=i("h1",null,"产品成本管理",-1)),i("span",re,"共 "+v(N.value.length)+" 条记录",1)]),i("div",de,[i("div",ce,[o(n,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"搜索SKU/商品名称/供应商...",clearable:"",class:"search-input",onChange:R,style:{width:"280px"}},{"prefix-icon":s(()=>[o(D(U),{name:"search"})]),_:1},8,["modelValue"]),o(c,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value=l),placeholder:"按创建时间筛选",clearable:"",style:{width:"300px"}},null,8,["modelValue"])]),i("div",pe,[o(_,{theme:"primary",onClick:T,class:"action-btn"},{icon:s(()=>[o(D(U),{name:"add"})]),default:s(()=>[e[16]||(e[16]=u(" 添加数据 ",-1))]),_:1}),o(_,{variant:"outline",onClick:G,class:"action-btn"},{icon:s(()=>[o(D(U),{name:"refresh"})]),default:s(()=>[e[17]||(e[17]=u(" 刷新数据 ",-1))]),_:1})])])]),i("div",me,[o(A,{data:N.value,columns:z,loading:C.value,"row-key":"id",pagination:b.value,onPageChange:E,size:"medium",hover:!0,class:"custom-table"},{productInfo:s(({row:l})=>[i("div",_e,[i("div",ve,v(l.product_name),1),i("div",ge,"SKU: "+v(l.sku||"无"),1),l.spec_info?($(),K("div",fe,v(l.spec_info),1)):ae("",!0)])]),priceInfo:s(({row:l})=>[i("div",he,[i("div",be,"¥"+v(l.total_cost.toFixed(2)),1),i("div",Ve,"采购: ¥"+v(l.purchase_price.toFixed(2)),1)])]),statusCell:s(({row:l})=>[o(j,{theme:l.is_active?"success":"default",variant:"light-outline",class:"type-tag"},{default:s(()=>[u(v(l.is_active?"有效":"无效"),1)]),_:2},1032,["theme"])]),op:s(({row:l})=>[i("div",ke,[o(_,{variant:"text",theme:"primary",onClick:w=>L(l)},{default:s(()=>[...e[18]||(e[18]=[u("修改",-1)])]),_:1},8,["onClick"]),o(_,{variant:"text",theme:"primary",onClick:w=>F(l)},{default:s(()=>[...e[19]||(e[19]=[u("复制",-1)])]),_:1},8,["onClick"]),o(_,{variant:"text",theme:"danger",onClick:w=>B(l)},{default:s(()=>[...e[20]||(e[20]=[u("删除",-1)])]),_:1},8,["onClick"])])]),_:1},8,["data","loading","pagination"])])]),o(O,{visible:g.value,"onUpdate:visible":e[14]||(e[14]=l=>g.value=l),size:"520px",placement:"right",onConfirm:P,"close-on-overlay-click":!1},Z({default:s(()=>[o(J,{ref_key:"formRef",ref:x,rules:W,data:t.value,"label-align":"right","label-width":120},{default:s(()=>[o(r,{label:"SKU编号",name:"sku",required:""},{default:s(()=>[o(n,{modelValue:t.value.sku,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.sku=l),placeholder:"如：CG-MC-GBC-26"},null,8,["modelValue"])]),_:1}),o(r,{label:"商品ID",name:"product_id",required:""},{default:s(()=>[o(n,{modelValue:t.value.product_id,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.product_id=l),type:"number",placeholder:"请输入商品ID"},null,8,["modelValue"])]),_:1}),o(r,{label:"商品名称",name:"product_name",required:""},{default:s(()=>[o(n,{modelValue:t.value.product_name,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.product_name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),o(r,{label:"规格信息",name:"spec_info",required:""},{default:s(()=>[o(n,{modelValue:t.value.spec_info,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.spec_info=l),placeholder:"请输入规格颜色等信息"},null,8,["modelValue"])]),_:1}),o(I,{align:"left",style:{"font-size":"12px",color:"#bbb",margin:"24px 0 16px"}},{default:s(()=>[...e[23]||(e[23]=[u("费用成本明细 (元)",-1)])]),_:1}),o(r,{label:"采购价",name:"purchase_price",required:""},{default:s(()=>[o(n,{modelValue:t.value.purchase_price,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.purchase_price=l),type:"number",step:"0.01"},{prefix:s(()=>[...e[24]||(e[24]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"运费",name:"shipping_cost",required:""},{default:s(()=>[o(n,{modelValue:t.value.shipping_cost,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.shipping_cost=l),type:"number",step:"0.01"},{prefix:s(()=>[...e[25]||(e[25]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"操作费",name:"handling_cost",required:""},{default:s(()=>[o(n,{modelValue:t.value.handling_cost,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.handling_cost=l),type:"number",step:"0.01"},{prefix:s(()=>[...e[26]||(e[26]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"其他费用",name:"other_cost",required:""},{default:s(()=>[o(n,{modelValue:t.value.other_cost,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.other_cost=l),type:"number",step:"0.01"},{prefix:s(()=>[...e[27]||(e[27]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"计算总成本",name:"total_cost"},{default:s(()=>[o(n,{modelValue:t.value.total_cost,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.total_cost=l),readonly:"",class:"readonly-input"},{prefix:s(()=>[...e[28]||(e[28]=[u("¥",-1)])]),_:1},8,["modelValue"])]),_:1}),o(I,{align:"left",style:{"font-size":"12px",color:"#bbb",margin:"24px 0 16px"}},{default:s(()=>[...e[29]||(e[29]=[u("供应及库存",-1)])]),_:1}),o(r,{label:"供应商",name:"supplier",required:""},{default:s(()=>[o(n,{modelValue:t.value.supplier,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.supplier=l),placeholder:"供应商名称"},null,8,["modelValue"])]),_:1}),o(r,{label:"当前库存",name:"stock",required:""},{default:s(()=>[o(n,{modelValue:t.value.stock,"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.stock=l),type:"number",placeholder:"0"},null,8,["modelValue"])]),_:1}),o(r,{label:"数据状态",name:"is_active"},{default:s(()=>[o(H,{modelValue:t.value.is_active,"onUpdate:modelValue":e[13]||(e[13]=l=>t.value.is_active=l),label:["启用","禁用"]},null,8,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:2},[f.value?{name:"header",fn:s(()=>[e[21]||(e[21]=u("编辑产品成本记录",-1))]),key:"0"}:{name:"header",fn:s(()=>[e[22]||(e[22]=u("添加产品成本记录",-1))]),key:"1"}]),1032,["visible"])],64)}}}),De=se(ye,[["__scopeId","data-v-ce83b2ea"]]);export{De as default};
